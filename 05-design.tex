\chapter{Конструкторский раздел}

В данном разделе будут более подробно рассмотрены выбранные в предыдущем разделе методы и алгоритмы, а также предоставлены требования к программному обеспечению.

\section{Требования к программному обеспечению}

Программа должна:
\begin{enumerate}
	\item Загружать модели из .obj файлов.
	\item Визуализировать трехмерные каркасные модели.
	\item Визуализировать морфинг двух трехмерных моделей.
	\item Преобразовывать модель: поворот, масштабирование и сдвиг.
	\item Изменять положение источника света.
	\item Изменять положение камеры.
	\item Изменять тип вершин, ребер.
	\item Изменять размер вершин и ребер.
\end{enumerate}


\section{Считывание моделей}

Для задания моделей был выбран один из наиболее популярных и универсальных методов – .obj файлы. 
Рассмотрим этапы считывания данных:

\begin{enumerate}
	\item Открытие файла .obj
	
	Программа открывает файл, предоставляя путь к нему в качестве входного параметра.
	
	\item Чтение вершин
	
	Из файла считываются строки, содержащие координаты вершин. 
	Каждая строка представляет собой набор координат в формате 'v x y z', где x, y и z - координаты вершины.
	
	\item Чтение граней
	
	Происходит чтение строк, представляющих грани. 
	Формат строки - 'f v1 v2...vn', где v1, v2...vn - индексы вершин, образующих грань.
	
	\item Обработка и хранение данных
	
	Прочитанные вершины и грани сохраняются в структуры данных, предназначенные для хранения геометрических данных 
	модели. 
	Вершины сохраняются в массиве, а грани - в структуре, содержащей информацию о связи вершин и порядке их соединения.
	
\end{enumerate}


\section{Общий алгоритм построения изображения}
Рассмотрим алгоритм построения кадра, он представлен на рисунке~\ref{fig:frame_algo}. 
Для визуализации объектов используется алгоритм Z-буфера, представлен на рисунке~\ref{fig:z-buffer}.
Он был рассмотрен для полигонов поверхностной модели.
Особое внимание стоит уделить расчету новых нормалей полигонов: это долгий процесс, чтобы его оптимизировать предлагается ввести список полигонов для каждой вершины, каждой вершине в данной структуре данных будет соответствовать полигоны, частями которых она является. 
После проведения данной подготовки для расчета нормали в соответствующей вершине достаточно будет рассчитать среднее из нормалей соответствующих ей в списке полигонов. 
Данный метод позволит многократно ускорить выполнение алгоритма~\cite{morphing_algo}.


\begin{figure}[H]
	\centering
	\includegraphics[height=1.5\textwidth]{images/frameAlgoMorph.pdf}
	\caption{Общий алгоритм построения кадра}
	\label{fig:frame_algo}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[height=1.5\textwidth]{images/z_buffer_morph.pdf}
	\caption{Алгоритм Z-буфера}
	\label{fig:z-buffer}
\end{figure}


Математические соображения о алгоритме Гуро приведены в~\ref{sec:draw_algo_analysis}.
Данный алгоритм позволяет получить довольно гладкое изображение при малых вычислительных затратах, что важно при необходимости постоянно пересчета нормалей при морфинге.
Необходимо отметить что интенсивность в вершинах полигона будет определяться как скалярное произведение вектора светового луча (вектора направленного из вершины к источнику света) и нормали в вершине.
\begin{figure}[h]
	\centering
	\includegraphics{images/guro_morph.pdf}
	\caption{Алгоритм закраски по Гуро}
	\label{fig:guro_algo}
\end{figure}

\section{Алгоритм морфинга}

Рассмотрим алгоритм морфинга двух объектов. Он представлен на рисунке~\ref{fig:morph_algorithm}.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.85]{images/morph_algo.png}
	\caption{Сравнение методов закраски}
	\label{fig:morph_algorithm}
\end{figure}


\section*{Выводы из конструкторского раздела}

В данном разделе была разобрана реализация выбранного алгоритма построения изображения, а также рассмотрены алгоритмы
Z-буфера, закраски по Гуро и морфинга двух фигур.

